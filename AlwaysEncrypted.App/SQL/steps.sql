--1) create certificate in the installer 
--$cert = New-SelfSignedCertificate -Subject "AlwaysEncryptedCert" -CertStoreLocation Cert:LocalMachine\My -KeyExportPolicy Exportable -Type DocumentEncryptionCert -KeyUsage KeyEncipherment -KeySpec KeyExchange -KeyLength 2048
--2) in c# code get the thumb print by cert subject (?)
--3) create the column master key using the thumb print
CREATE COLUMN MASTER KEY test_cmk   
    WITH (  
        KEY_STORE_PROVIDER_NAME = 'MSSQL_CERTIFICATE_STORE',  
        KEY_PATH = N'LocalMachine/My/54607B0332908AF1FE8AE121FE1FF811DDB7A29F'  
         )   
--4) create the column encryption key using the column master key (get the encrypted value from code GetEncryptionKey method in c# code

CREATE COLUMN ENCRYPTION KEY test_cek   
WITH VALUES  
(	
    COLUMN_MASTER_KEY = test_cmk,   
    ALGORITHM = 'RSA_OAEP',   
    ENCRYPTED_VALUE = 0x01700000016C006F00630061006C006D0061006300680069006E0065002F006D0079002F00350034003600300037006200300033003300320039003000380061006600310066006500380061006500310032003100660065003100660066003800310031006400640062003700610032003900660015EBC1B477A92666831AF1A0EE4FA61DA21369900964AB6D10827DC2D93098097B8F9E96E72E89A4C37C2F951A7EB2A67168C96DC65A26860FF4EF744CBF74B8B3AD0FC264C5611C404984FA0DCB0601FEE675E16ED38F8CF1B467827F3F6DF3594D50C3FCAF17EDED6C5CCB228AD5A007FFE9CE0E169A3F26BC2854FA2E6ECBF91C8DCF6112D24905A2936037D115B71D1F272892E9B56CC95A8846210211B5573E5F31C04AD839B0AF83FF6146FDDC8A955A8197D8944FBD83B3ED2F61FDB26931181F02922DF3F06DB504F11BC12643073775280F85831230D33178F514FF45DA59653CF4D04F10BC299FEC7F489FCB3BB86641D99A3F59052734A5CB4D3A61092729B2DFEFC7193D146707927A026D726F740C66C10B48FD56ABB4AA0F7372DF5072CF1CE569979D7D42723281FF31047EF7F9099DB771DBE655421790955F3BF4ACAABEF85DD547F6A111B73FA97DFDA3FE96C0B7D723132878E0B07AE4776A1B6F20E0A8E1FA8539B1FA4D4EF3ACE6558AC7FB319F9760583F3BC0D8FF73ADB9FBAB710D5DFB9AB3002DD5365CDA524006623939F5B9C2B9DFD3C89ADED9CBE5BFEB315D74D64A2890CFF3DA31BF836B57DE524CBC90CB9083C382FBF1359E8DFE37ABCAB3B13395A769B7B04F1E386B29723707B9F03342D590D350F91E898CD19216C0EEC941793E5CA87129673C701A99C88BF31C227D3EE246BFDB
);  
--5) create a new column with always encrypted enabled
ALTER TABLE USERS 
	ADD
    PIN_ENCRYPTED nvarchar(64)   
        COLLATE  Latin1_General_BIN2 ENCRYPTED WITH (COLUMN_ENCRYPTION_KEY = test_cek,  
        ENCRYPTION_TYPE = DETERMINISTIC,  
        ALGORITHM = 'AEAD_AES_256_CBC_HMAC_SHA_256')



